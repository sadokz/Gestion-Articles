# Makefile for FastAPI + PostgreSQL project

# Database config
DB_USER=''
DB_PASS=""
DB_NAME=gestion_articles
DB_HOST=localhost
DB_PORT=5432

# .env config
ENV_FILE=.env
ENV_CONTENT=DATABASE_URL=postgresql://$(DB_USER):$(DB_PASS)@$(DB_HOST):$(DB_PORT)/$(DB_NAME)

.PHONY: env install run dev clean createdb

env:
	@echo "ğŸ”§ Creating .env file..."
	@echo $(ENV_CONTENT) > $(ENV_FILE)
	@echo "âœ… .env created with database URL."

install:
	@echo "ğŸ“¦ Installing Python dependencies..."
	pip install -r requirements.txt

run:
	@echo "ğŸš€ Running FastAPI app..."
	uvicorn main:app --reload

dev: env install run

createdb:
	@echo "ğŸ› ï¸ Creating PostgreSQL database if not exists..."
	@psql -U $(DB_USER) -tc "SELECT 1 FROM pg_database WHERE datname = '$(DB_NAME)'" | grep -q 1 || createdb -U $(DB_USER) $(DB_NAME)
	@echo "âœ… Database '$(DB_NAME)' is ready."

clean:
	@echo "ğŸ§¹ Cleaning up environment..."
	rm -f $(ENV_FILE)
	rm -rf __pycache__
	@echo "ğŸ—‘ï¸ .env deleted."